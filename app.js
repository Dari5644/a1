// frontend logic (truncated for brevity in tool); same as previous detailed version